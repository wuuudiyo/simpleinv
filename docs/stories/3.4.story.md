# Story 3.4: Feinschliff und UX-Verbesserungen

## Status

Approved

## Story

**As a** Benutzer,
**I want** eine polierte, konsistente Benutzererfahrung,
**so that** die App professionell wirkt und Spaß macht zu benutzen.

## Acceptance Criteria

1. Ladezeiten: App startet in unter 3 Sekunden, UI reagiert in unter 100ms
2. Leere Zustände: Freundliche Nachrichten wenn keine Artikel/Kategorien vorhanden
3. Erfolgs-Feedback: Toast-Benachrichtigungen bei Aktionen (Artikel gespeichert, gelöscht, etc.)
4. Fehler-Feedback: Verständliche Fehlermeldungen bei Validierungsfehlern
5. Tastatur-Navigation: Tab-Reihenfolge ist logisch, Enter bestätigt Dialoge
6. Konsistente Abstände und Typografie über die gesamte App
7. Hover-Zustände für klickbare Elemente
8. Fokus-Indikatoren für Accessibility-Grundlagen
9. App-Icon ist gesetzt (kann Platzhalter sein)

## Tasks / Subtasks

- [ ] Task 1: Toast-System implementieren (AC: 3, 4)
  - [ ] `src/renderer/components/ui/Toast.tsx` erstellen
  - [ ] Props: `message: string`, `type: 'success' | 'error' | 'info' | 'warning'`, `duration?: number`
  - [ ] Auto-Dismiss nach 3 Sekunden (konfigurierbar)
  - [ ] Schließen-Button
  - [ ] Animations: Slide-in, Fade-out

- [ ] Task 2: Toast Store erstellen (AC: 3, 4)
  - [ ] `src/renderer/stores/uiStore.ts` erstellen
  - [ ] State: `toasts: Toast[]`
  - [ ] Actions: `showToast(message, type)`, `dismissToast(id)`
  - [ ] Auto-ID Generation für Toasts

- [ ] Task 3: ToastContainer Komponente (AC: 3, 4)
  - [ ] `src/renderer/components/ui/ToastContainer.tsx` erstellen
  - [ ] Position: Fixed, unten rechts
  - [ ] Rendert alle aktiven Toasts gestackt
  - [ ] Z-Index über anderen Elementen

- [ ] Task 4: Toast-Integration in CRUD-Operationen (AC: 3)
  - [ ] Nach `createArticle()` → Toast "Artikel erstellt"
  - [ ] Nach `updateArticle()` → Toast "Artikel aktualisiert"
  - [ ] Nach `deleteArticle()` → Toast "Artikel gelöscht"
  - [ ] Nach Category CRUD → entsprechende Toasts
  - [ ] Fehler bei Operationen → Error-Toast

- [ ] Task 5: Empty States implementieren (AC: 2)
  - [ ] `src/renderer/components/ui/EmptyState.tsx` erstellen
  - [ ] Props: `icon?: ReactNode`, `title: string`, `description?: string`, `action?: ReactNode`
  - [ ] ArticleTable: "Keine Artikel vorhanden. Fügen Sie Ihren ersten Artikel hinzu." + Button
  - [ ] CategoryManager: "Keine Kategorien vorhanden. Erstellen Sie Ihre erste Kategorie."

- [ ] Task 6: Fehler-Feedback verbessern (AC: 4)
  - [ ] Formular-Validierung: Inline-Fehlermeldungen unter Inputs
  - [ ] Fehlermeldungen auf Deutsch und verständlich
  - [ ] Highlight ungültiger Felder (roter Border)
  - [ ] Focus auf erstes fehlerhaftes Feld

- [ ] Task 7: Tastatur-Navigation (AC: 5)
  - [ ] Tab-Reihenfolge überprüfen in allen Modals
  - [ ] Enter in Formularen: Submit (nicht nur Button-Klick)
  - [ ] Escape in Modals: Schließen
  - [ ] Delete-Bestätigungsdialog: Enter = Bestätigen, Escape = Abbrechen
  - [ ] `tabIndex` wo nötig setzen

- [ ] Task 8: Hover-Zustände und Fokus-Indikatoren (AC: 7, 8)
  - [ ] Alle Buttons: Hover-Effekt (Farbänderung oder Schatten)
  - [ ] Tabellenzeilen: Hover-Highlight
  - [ ] Links/klickbare Elemente: Cursor-Pointer
  - [ ] Fokus-Ring für alle interaktiven Elemente (`focus:ring-2`)
  - [ ] Fokus sichtbar in Light und Dark Mode

- [ ] Task 9: Konsistente Abstände und Typografie (AC: 6)
  - [ ] Spacing-Audit: Einheitliche Abstände (p-4, p-6, gap-4, etc.)
  - [ ] Typography-Audit: Konsistente Font-Größen (text-sm, text-base, text-lg)
  - [ ] Heading-Hierarchie: h1 > h2 > h3 konsistent
  - [ ] TailwindCSS Klassen vereinheitlichen

- [ ] Task 10: App-Icon setzen (AC: 9)
  - [ ] Platzhalter-Icon erstellen oder herunterladen (256x256 PNG)
  - [ ] Icon in `resources/` Ordner ablegen
  - [ ] `forge.config.ts` oder Electron-Builder Konfiguration aktualisieren
  - [ ] Icon erscheint in Taskbar und Fenster-Titel

- [ ] Task 11: Performance-Audit (AC: 1)
  - [ ] App-Startzeit messen (Ziel: < 3s)
  - [ ] UI-Reaktionen messen (Ziel: < 100ms)
  - [ ] React DevTools Profiler nutzen für langsame Komponenten
  - [ ] Lazy Loading für Modals implementieren falls noch nicht vorhanden
  - [ ] Unnötige Re-Renders identifizieren und beheben

- [ ] Task 12: Manuelle Verifizierung (Alle AC)
  - [ ] App starten: Startzeit < 3 Sekunden
  - [ ] Leere DB: Empty State für Artikel sichtbar mit Action-Button
  - [ ] Artikel erstellen → Toast "Artikel erstellt" erscheint
  - [ ] Artikel löschen → Toast "Artikel gelöscht" erscheint
  - [ ] Fehler bei Validierung → verständliche Fehlermeldung, Feld hervorgehoben
  - [ ] Tab durch Formular → logische Reihenfolge
  - [ ] Enter in Formular → Submit
  - [ ] Escape in Modal → Modal schließt
  - [ ] Hover über Button → visueller Feedback
  - [ ] Tab zu Button → Fokus-Ring sichtbar
  - [ ] Alle Abstände und Schriften konsistent
  - [ ] App-Icon in Taskbar sichtbar

## Dev Notes

### Kontext aus vorherigen Stories

**Epic 1 + 2 + 3.1-3.3** haben die Kern-Funktionalität implementiert:
- CRUD für Artikel und Kategorien
- Dashboard mit Metriken
- Einstellungen-Seite
- Theme-System

**Diese Story** ist der finale Feinschliff vor dem MVP-Release.

### Toast Komponente [Source: architecture/6-komponenten-architektur.md]

```typescript
// src/renderer/components/ui/Toast.tsx

interface ToastProps {
  id: string;
  message: string;
  type: 'success' | 'error' | 'info' | 'warning';
  duration?: number; // ms, default 3000
  onClose: (id: string) => void;
}

// Farben:
// success: bg-green-100 border-green-500 text-green-800
// error: bg-red-100 border-red-500 text-red-800
// warning: bg-yellow-100 border-yellow-500 text-yellow-800
// info: bg-blue-100 border-blue-500 text-blue-800

// Icons (optional):
// success: ✓ Check
// error: ✗ X
// warning: ⚠ Triangle
// info: ℹ Circle
```

### UI Store für Toasts

```typescript
// src/renderer/stores/uiStore.ts

import { create } from 'zustand';

interface Toast {
  id: string;
  message: string;
  type: 'success' | 'error' | 'info' | 'warning';
}

interface UIState {
  toasts: Toast[];
  showToast: (message: string, type: Toast['type']) => void;
  dismissToast: (id: string) => void;
}

let toastId = 0;

export const useUIStore = create<UIState>((set) => ({
  toasts: [],

  showToast: (message, type) => {
    const id = `toast-${++toastId}`;
    set((state) => ({
      toasts: [...state.toasts, { id, message, type }],
    }));

    // Auto-dismiss after 3s
    setTimeout(() => {
      set((state) => ({
        toasts: state.toasts.filter((t) => t.id !== id),
      }));
    }, 3000);
  },

  dismissToast: (id) => {
    set((state) => ({
      toasts: state.toasts.filter((t) => t.id !== id),
    }));
  },
}));

// Helper für einfache Aufrufe
export const toast = {
  success: (message: string) => useUIStore.getState().showToast(message, 'success'),
  error: (message: string) => useUIStore.getState().showToast(message, 'error'),
  info: (message: string) => useUIStore.getState().showToast(message, 'info'),
  warning: (message: string) => useUIStore.getState().showToast(message, 'warning'),
};
```

### Toast-Integration in Stores

```typescript
// Beispiel in articleStore.ts

import { toast } from './uiStore';

createArticle: async (input: ArticleInput) => {
  try {
    const article = await window.api.articles.create(input);
    set((state) => ({
      articles: [...state.articles, article],
    }));
    toast.success('Artikel erstellt');
    return article;
  } catch (error) {
    toast.error('Fehler beim Erstellen des Artikels');
    throw error;
  }
},
```

### EmptyState Komponente

```typescript
// src/renderer/components/ui/EmptyState.tsx

interface EmptyStateProps {
  icon?: React.ReactNode;
  title: string;
  description?: string;
  action?: React.ReactNode;
}

export function EmptyState({ icon, title, description, action }: EmptyStateProps) {
  return (
    <div className="flex flex-col items-center justify-center py-12 text-center">
      {icon && <div className="text-gray-400 mb-4">{icon}</div>}
      <h3 className="text-lg font-medium text-gray-900 dark:text-gray-100">
        {title}
      </h3>
      {description && (
        <p className="mt-1 text-sm text-gray-500">{description}</p>
      )}
      {action && <div className="mt-4">{action}</div>}
    </div>
  );
}

// Verwendung in ArticleTable:
{articles.length === 0 && (
  <EmptyState
    icon={<PackageIcon className="w-12 h-12" />}
    title="Keine Artikel vorhanden"
    description="Fügen Sie Ihren ersten Artikel hinzu, um loszulegen."
    action={<Button onClick={onAddArticle}>Artikel hinzufügen</Button>}
  />
)}
```

### Keyboard Navigation Patterns

```typescript
// Modal mit Escape-to-close
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Escape') {
      onClose();
    }
  };
  window.addEventListener('keydown', handleKeyDown);
  return () => window.removeEventListener('keydown', handleKeyDown);
}, [onClose]);

// Form mit Enter-to-submit
<form onSubmit={handleSubmit}>
  <Input ... />
  <Button type="submit">Speichern</Button>
</form>

// Confirm Dialog: Enter = Confirm
useEffect(() => {
  const handleKeyDown = (e: KeyboardEvent) => {
    if (e.key === 'Enter') {
      onConfirm();
    }
  };
  // ...
}, [onConfirm]);
```

### Fokus-Styling mit Tailwind

```css
/* Basis-Klassen für alle interaktiven Elemente */

/* Buttons */
.btn {
  @apply focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500;
}

/* Inputs */
.input {
  @apply focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent;
}

/* Tabellenzeilen */
.table-row {
  @apply hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer;
}
```

### App-Icon Konfiguration

```typescript
// forge.config.ts (Electron Forge)

export default {
  packagerConfig: {
    icon: './resources/icon', // ohne Dateiendung
    // Electron sucht automatisch nach:
    // - icon.ico (Windows)
    // - icon.icns (macOS)
    // - icon.png (Linux)
  },
  // ...
};
```

### Performance Best Practices

```typescript
// Lazy Loading für Modals
const SettingsModal = React.lazy(() => import('./components/settings/SettingsModal'));
const ArticleForm = React.lazy(() => import('./components/articles/ArticleForm'));

// Verwendung mit Suspense
<Suspense fallback={<Spinner />}>
  {isSettingsOpen && <SettingsModal ... />}
</Suspense>

// Memoization für teure Berechnungen
const articlesWithCalculations = useMemo(
  () => articles.map(withCalculations),
  [articles]
);

// useCallback für stabile Referenzen
const handleRowClick = useCallback((article: Article) => {
  setSelectedId(article.id);
}, []);
```

### File Locations [Source: architecture/10-projektstruktur.md]

```
src/
├── renderer/
│   ├── components/
│   │   └── ui/
│   │       ├── Toast.tsx           ← NEU
│   │       ├── ToastContainer.tsx  ← NEU
│   │       └── EmptyState.tsx      ← NEU
│   └── stores/
│       └── uiStore.ts              ← NEU
│
└── resources/
    ├── icon.ico                     ← NEU (Windows)
    ├── icon.png                     ← NEU (Linux)
    └── icon.icns                    ← NEU (macOS, optional)
```

### NFR Referenz [Source: PRD]

- **NFR1:** App startet in unter 3 Sekunden, UI-Reaktionen unter 100ms
- **NFR5:** Cleanes, Notion-inspiriertes Design mit minimaler Lernkurve

### Testing

**Testing-Standards für diese Story:** [Source: architecture/14-testing-strategie.md]
- MVP-Phase: Keine automatisierten Tests erforderlich
- Manuelle Verifizierung der Acceptance Criteria ist ausreichend

**Manuelle Test-Checkliste:**
- [ ] `npm start` startet die App ohne Fehler
- [ ] Startzeit < 3 Sekunden (mit Stoppuhr messen)
- [ ] Empty State bei leerer Artikel-Liste mit Action-Button
- [ ] Artikel erstellen → Toast "Artikel erstellt" (grün)
- [ ] Artikel löschen → Toast "Artikel gelöscht" (grün)
- [ ] Duplikat-Kategorie → Toast Fehlermeldung (rot)
- [ ] Validierungsfehler: Roter Border + Fehlermeldung unter Feld
- [ ] Tab-Navigation: Logische Reihenfolge durch alle Felder
- [ ] Enter in Formular → Submit
- [ ] Escape in Modal → Schließen
- [ ] Hover über Buttons → Farbänderung
- [ ] Hover über Tabellenzeilen → Highlight
- [ ] Tab zu Button → Fokus-Ring sichtbar
- [ ] Dark Mode: Fokus-Ring noch sichtbar
- [ ] App-Icon in Taskbar und Fenster-Titel

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 0.1 | Initial story draft | PO Sarah |

## Dev Agent Record

### Agent Model Used

*To be filled by Dev Agent*

### Debug Log References

*To be filled by Dev Agent*

### Completion Notes List

*To be filled by Dev Agent*

### File List

*To be filled by Dev Agent*

## QA Results

*To be filled by QA Agent*
